# Midterm Project – UCI Heart Disease Sites

## Project Overview

This project demonstrates why a “one-size-fits-all” approach fails across the UCI Heart Disease sites (Cleveland, Hungary, Switzerland, Long Beach VA). A preparation script builds clean, site-wise imputations that respect structured missingness, and a Streamlit dashboard lets you explore disease patterns, compare imputers, and observe the generalization gap when models are tuned on Cleveland alone.

## Quick Start

```bash
python prepare.py        # generate imputed datasets and summary prints
streamlit run app.py     # launch the dashboard
```

All paths are relative; no data downloads are required. The raw CSVs must remain alongside the scripts.

## Rubric Alignment

### Data Collection & Prep (25%)
- Uses four distinct local sources: `cleveland.data`, `hungary.data`, `switzerland.data`, `long_beach_va.data` (all tagged with an `origin` column).
- `prepare.py` prints per-site duplicate diagnostics (exact matches, feature-only duplicates, conflicting labels) and drops **exact duplicates only**.
- Missing values: Switzerland’s `chol==0` converted to `NaN`, categorical codes imputed with per-site `SimpleImputer(most_frequent)`, numeric fields imputed with per-site `StandardScaler` → `KNNImputer(k=5)` → inverse scaling (Switzerland `chol` excluded from KNN and left missing).
- Dtypes clarified: categorical codes cast to nullable `Int64`, `origin` stored as categorical, binary target `target = (num > 0)` added alongside original `num`.
- Saved outputs: `heart_imputed_sitewise.csv` (primary) and `heart_imputed_simple.csv` (baseline comparison).

### EDA & Visualization (25%)
- Dashboard visualizations tied to disease presence (`target`):
  - Boxplots: `oldpeak` vs target, `thalach` vs target.
  - Count plot: chest pain type (`cp`) split by target.
  - Interaction scatter: `oldpeak` vs `thalach`, color-coded by target and faceted by origin (style).
  - Missingness heatmap for `['chol', 'ca', 'thal', 'origin', 'target']` highlights Switzerland’s structural gaps.
- Basic statistics section (mean/median/std) for selected vitals plus class balance table per origin.
- On-page captions explain how each figure supports the “one-size-fits-all is false” narrative.

### Data Processing (15%)
- Two imputation approaches:
  - **Site-wise KNN** (primary): StandardScaler → KNN (k=5) per origin.
  - **Simple per-site median** baseline: most-frequent for categoricals, median for numerics (shown in stability table and toggleable in app).
- No imputation applied to the label `num`; Switzerland `chol` remains missing under the KNN strategy to respect structural absence.

### Streamlit (25%)
- Functional app with at least two interactive controls: imputation strategy radio, origin multiselect, age range slider, optional “hide cholesterol” checkbox.
- Clear narrative text and inline captions explain what to examine and why site-wise handling matters.
- Includes instructions for deployment (see below) and a polished, clean layout with collapsible previews and captions.

### GitHub & Documentation (10%)
- Organized repository with core files: `prepare.py`, `app.py`, `README.md`, `requirements.txt`, and the original data files.
- README provides overview, setup steps, rubric mapping, and highlights for graders.

### Above & Beyond (+20% potential)
- Complex missingness highlighted via heatmap and optional “hide cholesterol” control that respects Switzerland’s structural gaps.
- Stability snapshot contrasts mean `oldpeak`, `thalach`, and `ca` by origin across both imputers.
- Generalization demo: logistic regression trained on Cleveland only, accuracy/AUC reported for each test site to reveal the generalization gap when relying on Cleveland.
- Streamlit UI includes captions, toggles, and a data preview expander for a polished feel.

## File Guide

| File | Purpose |
| --- | --- |
| `prepare.py` | Loads site CSVs, reports duplicates, performs site-wise imputations (KNN + simple baseline), prints summary tables, saves processed datasets, and runs the generalization demo. |
| `app.py` | Streamlit dashboard: interactive filtering, disease-linked charts, missingness heatmap, stability snapshot, and generalization results. |
| `heart_imputed_sitewise.csv` | Output of site-wise KNN pipeline (generated by running `prepare.py`). |
| `heart_imputed_simple.csv` | Baseline simple imputation output for comparison. |
| `requirements.txt` | Minimal dependencies for reproducing the workflow. |
| `heart-disease.names` | Original UCI data dictionary for reference. |

## Deployment (Streamlit Community Cloud)

1. Push the project to GitHub.
2. Sign in at [streamlit.io](https://share.streamlit.io/) and select “New app.”
3. Point to your repository and set the entry point to `app.py`.
4. Click **Deploy** (ensure `python prepare.py` has been run locally or provide the generated CSVs in the repo).

## Notes for Graders

- Run `python prepare.py` first to regenerate the outputs and view console summaries (duplicate counts, missingness report, stability snapshot, logistic regression metrics).
- Launch `streamlit run app.py` to explore the interactive narrative.
- Toggle between imputation strategies to see how Switzerland’s structural cholesterol missingness is preserved (KNN) or filled (simple median), reinforcing that cross-site leakage distorts downstream analyses.

Enjoy exploring why the heart disease benchmark behaves differently once every site gets the care it deserves!*** End Patch
